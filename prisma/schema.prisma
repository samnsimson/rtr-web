generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// User model for authentication and user management
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  password  String?
  role      UserRole @default(CANDIDATE)
  avatar    String?
  phone     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  recruiterProfile RecruiterProfile?
  candidateProfile CandidateProfile?
  rtrs             RTR[]
  rtrHistory       RTRHistory[]
  notifications    Notification[]

  @@map("users")
}

// Recruiter-specific profile information
model RecruiterProfile {
  id             String       @id @default(cuid())
  userId         String       @unique
  companyName    String
  companyWebsite String?
  industry       String?
  companySize    CompanySize?
  location       String?
  bio            String?
  linkedinUrl    String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  // Relations
  user User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobs Job[]
  rtrs RTR[]

  @@map("recruiter_profiles")
}

// Candidate-specific profile information
model CandidateProfile {
  id                String           @id @default(cuid())
  userId            String           @unique
  title             String?
  experience        Int? // Years of experience
  skills            String[] // Array of skills
  resumeUrl         String?
  linkedinUrl       String?
  portfolioUrl      String?
  location          String?
  willingToRelocate Boolean          @default(false)
  remotePreference  RemotePreference @default(ANY)
  expectedSalary    Int? // Annual salary expectation
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  // Relations
  user         User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  applications JobApplication[]
  rtrs         RTR[]

  @@map("candidate_profiles")
}

// Job/Position model
model Job {
  id           String           @id @default(cuid())
  title        String
  company      String
  description  String
  requirements String[]
  location     String
  workType     WorkType
  jobType      JobType
  compensation CompensationType
  salaryMin    Int?
  salaryMax    Int?
  benefits     String[]
  recruiterId  String
  status       JobStatus        @default(ACTIVE)
  expiresAt    DateTime?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt

  // Relations
  recruiter    RecruiterProfile @relation(fields: [recruiterId], references: [id], onDelete: Cascade)
  rtrs         RTR[]
  applications JobApplication[]

  @@map("jobs")
}

// Right to Represent model
model RTR {
  id          String    @id @default(cuid())
  candidateId String
  recruiterId String
  jobId       String?
  status      RTRStatus @default(PENDING)
  notes       String?
  expiresAt   DateTime?
  signedAt    DateTime?
  viewedAt    DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  candidate CandidateProfile @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  recruiter RecruiterProfile @relation(fields: [recruiterId], references: [id], onDelete: Cascade)
  job       Job?             @relation(fields: [jobId], references: [id], onDelete: SetNull)
  history   RTRHistory[]
  documents Document[]
  User      User?            @relation(fields: [userId], references: [id])
  userId    String?

  @@map("rtrs")
}

// RTR History for tracking status changes
model RTRHistory {
  id        String   @id @default(cuid())
  rtrId     String
  userId    String
  action    String // e.g., "created", "sent", "viewed", "signed", "expired"
  details   String?
  createdAt DateTime @default(now())

  // Relations
  rtr  RTR  @relation(fields: [rtrId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("rtr_history")
}

// Job Application model
model JobApplication {
  id          String            @id @default(cuid())
  jobId       String
  candidateId String
  status      ApplicationStatus @default(APPLIED)
  coverLetter String?
  appliedAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  // Relations
  job       Job              @relation(fields: [jobId], references: [id], onDelete: Cascade)
  candidate CandidateProfile @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@unique([jobId, candidateId])
  @@map("job_applications")
}

// Document model for storing RTR-related files
model Document {
  id         String       @id @default(cuid())
  rtrId      String
  name       String
  type       DocumentType
  url        String
  size       Int // File size in bytes
  mimeType   String
  uploadedAt DateTime     @default(now())

  // Relations
  rtr RTR @relation(fields: [rtrId], references: [id], onDelete: Cascade)

  @@map("documents")
}

// Notification model
model Notification {
  id        String           @id @default(cuid())
  userId    String
  title     String
  message   String
  type      NotificationType
  isRead    Boolean          @default(false)
  data      Json? // Additional data for the notification
  createdAt DateTime         @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

// Enums
enum UserRole {
  ADMIN
  RECRUITER
  CANDIDATE
}

enum CompanySize {
  STARTUP
  SMALL
  MEDIUM
  LARGE
  ENTERPRISE
}

enum RemotePreference {
  ANY
  REMOTE_ONLY
  HYBRID_ONLY
  ON_SITE_ONLY
}

enum WorkType {
  REMOTE
  HYBRID
  ON_SITE
}

enum JobType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERNSHIP
  FREELANCE
}

enum CompensationType {
  SALARY
  HOURLY
  PROJECT_BASED
  COMMISSION
}

enum JobStatus {
  ACTIVE
  INACTIVE
  CLOSED
  DRAFT
}

enum RTRStatus {
  DRAFT
  PENDING
  SENT
  VIEWED
  SIGNED
  EXPIRED
  REJECTED
}

enum ApplicationStatus {
  APPLIED
  REVIEWING
  INTERVIEWING
  OFFERED
  ACCEPTED
  REJECTED
  WITHDRAWN
}

enum DocumentType {
  RTR_FORM
  RESUME
  COVER_LETTER
  CONTRACT
  OTHER
}

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ERROR
  RTR_UPDATE
  JOB_UPDATE
}
